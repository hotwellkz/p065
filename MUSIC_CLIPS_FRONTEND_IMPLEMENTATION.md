# Реализация UI для Music Clips

## Изменённые/добавленные файлы

### 1. Типы и API
- **`src/domain/channel.ts`** - Расширен интерфейс `Channel`:
  - Добавлен `type?: ChannelType` ("shorts" | "music_clips")
  - Добавлен интерфейс `MusicClipsSettings` с настройками для music_clips
  - Обновлён `channelConverter` для сохранения новых полей

- **`src/api/musicClips.ts`** (новый файл) - API client для Music Clips:
  - `runMusicClipsOnce(channelId, userId)` - запуск пайплайна
  - `getMusicClipsMediaUrl(...)` - формирование URL для медиа-файлов

### 2. Компоненты
- **`src/components/ChannelCard.tsx`** - Добавлена поддержка Run Once:
  - Новые пропсы: `onMusicClipsRunOnce`, `isRunningMusicClips`
  - Кнопка "Run Once" для music_clips каналов (фиолетовая, с иконкой Music)

- **`src/components/ChannelCardCompact.tsx`** - Добавлена поддержка Run Once:
  - Новые пропсы: `onMusicClipsRunOnce`, `isRunningMusicClips`
  - Кнопка Run Once в компактном виде

### 3. Страницы
- **`src/pages/ChannelList/ChannelListPage.tsx`** - Основные изменения:
  - Добавлен фильтр по типу канала (`channelTypeFilter`)
  - Переключатель типа канала в UI (Shorts / Music Clips / Все)
  - Обработчик `handleMusicClipsRunOnce` для запуска пайплайна
  - Навигация "Music Clips" в меню (десктоп и мобильная версия)
  - Автоматическая фильтрация при переходе на `/music-clips`

- **`src/pages/ChannelEdit/ChannelEditPage.tsx`** - Форма редактирования:
  - Переключатель типа канала в начале формы
  - Секция "Настройки Music Clips" (Accordion):
    - Промпт для Suno (textarea)
    - Теги стиля (chips с возможностью добавления/удаления)
    - Целевая длительность (сек)
    - Длительность сегмента (сек, disabled, default 10)
    - Задержка между сегментами (мс)
    - Макс. параллельных сегментов
    - Макс. попыток
    - Платформы для публикации (YouTube, TikTok, Instagram - checkboxes)

### 4. Роутинг
- **`src/router.tsx`** - Добавлен роут:
  - `/music-clips` - страница списка каналов с фильтром music_clips

## Команды PowerShell для запуска

### Установка зависимостей
```powershell
npm install
```

### Запуск в режиме разработки
```powershell
npm run dev
```

### Сборка для продакшена
```powershell
npm run build
```

### Просмотр собранного проекта
```powershell
npm run preview
```

## Где найти Music Clips в UI

### Навигация
1. **В левом меню (десктоп)**: Кнопка "Music Clips" в заголовке страницы каналов
2. **В мобильном меню**: Пункт "Music Clips" в выпадающем меню (три точки)

### Переключатель типа канала
- На странице `/channels` или `/music-clips` в заголовке есть переключатель:
  - **Все** - показывает все каналы
  - **Shorts** - только shorts каналы
  - **Music Clips** - только music_clips каналы

### Кнопка Run Once
- В карточке канала типа `music_clips`:
  - **Десктоп**: Фиолетовая кнопка "Run Once" с иконкой Music
  - **Мобильная**: Фиолетовая кнопка с иконкой Music в компактном виде
- При нажатии запускается пайплайн, показывается индикатор загрузки

### Форма редактирования
- При редактировании канала в начале формы есть переключатель:
  - **Shorts** - обычный канал
  - **Music Clips** - канал для Music Clips
- При выборе "Music Clips" появляется секция "Настройки Music Clips" с полями:
  - Промпт для Suno
  - Теги стиля
  - Параметры генерации
  - Платформы для публикации

## API Endpoints (используемые)

1. **POST** `/api/music-clips/channels/:channelId/runOnce`
   - Запускает пайплайн Music Clips для канала
   - Требует авторизации (Bearer token)
   - Возвращает: `{ success: boolean, error?: string, publishedPlatforms?: string[] }`

2. **GET** `/api/music-clips/media/:userFolderKey/:channelFolderKey/:fileName`
   - Отдаёт медиа-файлы (final.mp4, track.mp3 и т.д.)
   - Поддерживает Range-запросы для потоковой передачи

## Особенности реализации

1. **Фильтрация каналов**: Каналы фильтруются по типу (`type === "music_clips"` или `type === "shorts"` или отсутствует type = shorts по умолчанию)

2. **Автоматическая инициализация**: При переключении канала на тип "music_clips" автоматически создаются настройки по умолчанию

3. **Визуальное отличие**: Music Clips каналы имеют фиолетовую кнопку Run Once вместо обычной зелёной "Сгенерировать"

4. **Toast уведомления**: При запуске Run Once показываются toast с результатом (успех/ошибка)

5. **Состояние загрузки**: Кнопка Run Once показывает индикатор загрузки во время выполнения

## Известные ограничения

1. **Просмотр файлов**: Пока нет отдельного компонента для просмотра списка файлов. Можно использовать прямой URL через `getMusicClipsMediaUrl()`.

2. **Список файлов**: Backend не предоставляет endpoint для получения списка файлов, поэтому показывается только последний известный файл из ответа runOnce.

3. **Расписание**: Music Clips каналы пока не интегрированы с общим расписанием (можно добавить позже).

## Следующие шаги (опционально)

1. Добавить компонент для просмотра списка файлов (final.mp4, track.mp3)
2. Добавить интеграцию с расписанием для Music Clips
3. Добавить мониторинг статуса выполнения пайплайна
4. Добавить логи/историю запусков

