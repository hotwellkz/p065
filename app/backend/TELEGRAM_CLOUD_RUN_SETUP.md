# üîê –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Telegram –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –¥–ª—è Cloud Run

## –ü—Ä–æ–±–ª–µ–º–∞

–ü–æ—Å–ª–µ –¥–µ–ø–ª–æ—è backend –Ω–∞ Cloud Run –ø–æ—è–≤–ª—è–µ—Ç—Å—è –æ—à–∏–±–∫–∞:
> "Telegram –Ω–µ –ø–æ–¥–∫–ª—é—á—ë–Ω. –ê–≤—Ç–æ—Ä–∏–∑—É–π—Ç–µ—Å—å —á–µ—Ä–µ–∑ backend –∫–æ–º–∞–Ω–¥–æ–π: npm run dev:login"

–≠—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø–æ—Ç–æ–º—É, —á—Ç–æ Cloud Run –Ω–µ –º–æ–∂–µ—Ç –≤—ã–ø–æ–ª–Ω–∏—Ç—å –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π –ª–æ–≥–∏–Ω –≤–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞.

## –†–µ—à–µ–Ω–∏–µ

–ò—Å–ø–æ–ª—å–∑—É–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –æ–∫—Ä—É–∂–µ–Ω–∏—è `TELEGRAM_SESSION_ENCRYPTED` –¥–ª—è –ø–µ—Ä–µ–¥–∞—á–∏ –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω–æ–π —Å–µ—Å—Å–∏–∏ –≤ Cloud Run.

---

## üìã –ü–æ—à–∞–≥–æ–≤–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è

### –®–∞–≥ 1: –õ–æ–∫–∞–ª—å–Ω–∞—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è Telegram

–ù–∞ –ª–æ–∫–∞–ª—å–Ω–æ–π –º–∞—à–∏–Ω–µ –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ `backend`:

```bash
# –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ .env –Ω–∞—Å—Ç—Ä–æ–µ–Ω —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏
# TELEGRAM_API_ID, TELEGRAM_API_HASH, TELEGRAM_SESSION_SECRET

# –í—ã–ø–æ–ª–Ω–∏—Ç–µ –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π –ª–æ–≥–∏–Ω
npm run dev:login
```

–°–ª–µ–¥—É–π—Ç–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º:
1. –í–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `+79991234567`)
2. –í–≤–µ–¥–∏—Ç–µ –∫–æ–¥ –∏–∑ Telegram/SMS
3. –ï—Å–ª–∏ –≤–∫–ª—é—á—ë–Ω 2FA, –≤–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å

–ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –ª–æ–≥–∏–Ω–∞ —Å–µ—Å—Å–∏—è –±—É–¥–µ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞ –≤ —Ñ–∞–π–ª `telegram-session.enc`.

### –®–∞–≥ 2: –≠–∫—Å–ø–æ—Ä—Ç —Å–µ—Å—Å–∏–∏ –¥–ª—è Cloud Run

–ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –ª–æ–≥–∏–Ω–∞ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:

```bash
npm run export:telegram-session
```

–°–∫—Ä–∏–ø—Ç –≤—ã–≤–µ–¥–µ—Ç –∑–Ω–∞—á–µ–Ω–∏–µ –¥–ª—è –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –æ–∫—Ä—É–∂–µ–Ω–∏—è `TELEGRAM_SESSION_ENCRYPTED`.

**–ü—Ä–∏–º–µ—Ä –≤—ã–≤–æ–¥–∞:**
```
‚úÖ –°–µ—Å—Å–∏—è –Ω–∞–π–¥–µ–Ω–∞!

üìã –î–æ–±–∞–≤—å—Ç–µ —Å–ª–µ–¥—É—é—â—É—é –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –æ–∫—Ä—É–∂–µ–Ω–∏—è –≤ Cloud Run:

‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
TELEGRAM_SESSION_ENCRYPTED=iv.base64.authTag.base64.encrypted.base64
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
```

### –®–∞–≥ 3: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –≤ Cloud Run

#### –í–∞—Ä–∏–∞–Ω—Ç A: –ß–µ—Ä–µ–∑ Cloud Console (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

1. –û—Ç–∫—Ä–æ–π—Ç–µ [Cloud Console](https://console.cloud.google.com/run)
2. –í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–æ–µ–∫—Ç –∏ —Å–µ—Ä–≤–∏—Å `shorts-backend`
3. –ù–∞–∂–º–∏—Ç–µ **Edit & Deploy New Revision**
4. –í —Ä–∞–∑–¥–µ–ª–µ **Variables & Secrets** ‚Üí **Variables**:
   - –ù–∞–∂–º–∏—Ç–µ **Add Variable**
   - **Key**: `TELEGRAM_SESSION_ENCRYPTED`
   - **Value**: –∑–Ω–∞—á–µ–Ω–∏–µ –∏–∑ —à–∞–≥–∞ 2 (—Å–∫–æ–ø–∏—Ä—É–π—Ç–µ –ø–æ–ª–Ω–æ—Å—Ç—å—é)
   - –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ

5. –ù–∞–∂–º–∏—Ç–µ **Deploy**

#### –í–∞—Ä–∏–∞–Ω—Ç B: –ß–µ—Ä–µ–∑ gcloud CLI

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –ø—Ä–æ–µ–∫—Ç –∏ —Ä–µ–≥–∏–æ–Ω
gcloud config set project YOUR_PROJECT_ID
export REGION=us-central1
export SERVICE_NAME=shorts-backend

# –î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é (–∑–∞–º–µ–Ω–∏—Ç–µ ENCRYPTED_SESSION_VALUE –Ω–∞ –∑–Ω–∞—á–µ–Ω–∏–µ –∏–∑ —à–∞–≥–∞ 2)
gcloud run services update $SERVICE_NAME \
  --region $REGION \
  --update-env-vars "TELEGRAM_SESSION_ENCRYPTED=ENCRYPTED_SESSION_VALUE"
```

**‚ö†Ô∏è –í–ê–ñ–ù–û:** 
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ç–æ—Ç –∂–µ `TELEGRAM_SESSION_SECRET`, —á—Ç–æ –∏ –ø—Ä–∏ –ª–æ–∫–∞–ª—å–Ω–æ–º –ª–æ–≥–∏–Ω–µ
- –ó–Ω–∞—á–µ–Ω–∏–µ `TELEGRAM_SESSION_ENCRYPTED` –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –¥–æ–±–∞–≤–ª–µ–Ω–æ –≤ Cloud Run **–¥–æ** –¥–µ–ø–ª–æ—è

### –®–∞–≥ 4: –ü—Ä–æ–≤–µ—Ä–∫–∞

–ü–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –∏ –¥–µ–ø–ª–æ—è:

1. –û—Ç–∫—Ä–æ–π—Ç–µ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥ –Ω–∞ Netlify
2. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –ø—Ä–æ–º–ø—Ç –≤ Telegram
3. –û—à–∏–±–∫–∞ "Telegram –Ω–µ –ø–æ–¥–∫–ª—é—á—ë–Ω" –¥–æ–ª–∂–Ω–∞ –∏—Å—á–µ–∑–Ω—É—Ç—å

---

## üîÑ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–µ—Å—Å–∏–∏

–ï—Å–ª–∏ —Å–µ—Å—Å–∏—è –∏—Å—Ç–µ–∫–ª–∞ –∏–ª–∏ –Ω—É–∂–Ω–æ –ø–µ—Ä–µ–∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞—Ç—å—Å—è:

1. –í—ã–ø–æ–ª–Ω–∏—Ç–µ `npm run dev:login` –ª–æ–∫–∞–ª—å–Ω–æ
2. –í—ã–ø–æ–ª–Ω–∏—Ç–µ `npm run export:telegram-session`
3. –û–±–Ω–æ–≤–∏—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é `TELEGRAM_SESSION_ENCRYPTED` –≤ Cloud Run (—Å–º. –®–∞–≥ 3)
4. –ó–∞–¥–µ–ø–ª–æ–π—Ç–µ –Ω–æ–≤—É—é —Ä–µ–≤–∏–∑–∏—é

---

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- ‚úÖ **–ù–ï –∫–æ–º–º–∏—Ç—å—Ç–µ** `telegram-session.enc` –≤ Git (—É–∂–µ –≤ .gitignore)
- ‚úÖ **–ù–ï –∫–æ–º–º–∏—Ç—å—Ç–µ** –∑–Ω–∞—á–µ–Ω–∏–µ `TELEGRAM_SESSION_ENCRYPTED` –≤ Git
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ **Secret Manager** –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —Å–µ–∫—Ä–µ—Ç–æ–≤ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ **–æ–¥–∏–Ω–∞–∫–æ–≤—ã–π** `TELEGRAM_SESSION_SECRET` –¥–ª—è —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è/—Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∫–∏

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ Secret Manager (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

–î–ª—è –±–æ–ª—å—à–µ–π –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Google Secret Manager:

```bash
# –°–æ–∑–¥–∞–π—Ç–µ —Å–µ–∫—Ä–µ—Ç
echo -n "ENCRYPTED_SESSION_VALUE" | gcloud secrets create telegram-session-encrypted --data-file=-

# –î–æ–±–∞–≤—å—Ç–µ —Å–µ–∫—Ä–µ—Ç –≤ Cloud Run
gcloud run services update $SERVICE_NAME \
  --region $REGION \
  --update-secrets "TELEGRAM_SESSION_ENCRYPTED=telegram-session-encrypted:latest"
```

---

## üìù –¢—Ä–µ–±—É–µ–º—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –≤ Cloud Run

–î–ª—è —Ä–∞–±–æ—Ç—ã Telegram –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ –Ω—É–∂–Ω—ã —Å–ª–µ–¥—É—é—â–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ:

**–û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ:**
- `TELEGRAM_API_ID` - ID Telegram API (–∏–∑ https://my.telegram.org/apps)
- `TELEGRAM_API_HASH` - Hash Telegram API
- `TELEGRAM_SESSION_SECRET` - –°–µ–∫—Ä–µ—Ç –¥–ª—è —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è (64 hex —Å–∏–º–≤–æ–ª–∞)
- `TELEGRAM_SESSION_ENCRYPTED` - –ó–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω–∞—è —Å–µ—Å—Å–∏—è (–∏–∑ `npm run export:telegram-session`)
- `SYNX_CHAT_ID` - ID —á–∞—Ç–∞ SyntX (–Ω–∞–ø—Ä–∏–º–µ—Ä, `@syntxaibot`)

**–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ:**
- `FRONTEND_ORIGIN` - URL —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞ (–¥–ª—è CORS)
- `ENABLE_CRON_SCHEDULER` - –í–∫–ª—é—á–∏—Ç—å cron –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ (`false` –¥–ª—è Cloud Run)

---

## üÜò –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### –û—à–∏–±–∫–∞: "TELEGRAM_SESSION_NOT_INITIALIZED"

**–ü—Ä–∏—á–∏–Ω–∞:** –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è `TELEGRAM_SESSION_ENCRYPTED` –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ –∏–ª–∏ –Ω–µ–≤–µ—Ä–Ω–∞.

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è –¥–æ–±–∞–≤–ª–µ–Ω–∞ –≤ Cloud Run
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –∑–Ω–∞—á–µ–Ω–∏–µ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ –ø–æ–ª–Ω–æ—Å—Ç—å—é (–±–µ–∑ –ø–µ—Ä–µ–Ω–æ—Å–æ–≤ —Å—Ç—Ä–æ–∫)
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ `TELEGRAM_SESSION_SECRET` –æ–¥–∏–Ω–∞–∫–æ–≤—ã–π –≤ –ª–æ–∫–∞–ª—å–Ω–æ–π –∏ Cloud Run —Å—Ä–µ–¥–µ

### –û—à–∏–±–∫–∞: "Failed to decrypt TELEGRAM_SESSION_ENCRYPTED"

**–ü—Ä–∏—á–∏–Ω–∞:** –ù–µ–≤–µ—Ä–Ω—ã–π `TELEGRAM_SESSION_SECRET` –∏–ª–∏ –ø–æ–≤—Ä–µ–∂–¥—ë–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ.

**–†–µ—à–µ–Ω–∏–µ:**
1. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ `TELEGRAM_SESSION_SECRET` –æ–¥–∏–Ω–∞–∫–æ–≤—ã–π –≤–µ–∑–¥–µ
2. –ü–µ—Ä–µ—ç–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–π—Ç–µ —Å–µ—Å—Å–∏—é: `npm run export:telegram-session`
3. –û–±–Ω–æ–≤–∏—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –≤ Cloud Run

### –û—à–∏–±–∫–∞: "TELEGRAM_SESSION_EXPIRED_NEED_RELOGIN"

**–ü—Ä–∏—á–∏–Ω–∞:** –°–µ—Å—Å–∏—è –∏—Å—Ç–µ–∫–ª–∞ –∏–ª–∏ –±—ã–ª–∞ –æ—Ç–æ–∑–≤–∞–Ω–∞.

**–†–µ—à–µ–Ω–∏–µ:**
1. –í—ã–ø–æ–ª–Ω–∏—Ç–µ –Ω–æ–≤—ã–π –ª–æ–≥–∏–Ω: `npm run dev:login`
2. –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–π—Ç–µ –Ω–æ–≤—É—é —Å–µ—Å—Å–∏—é: `npm run export:telegram-session`
3. –û–±–Ω–æ–≤–∏—Ç–µ `TELEGRAM_SESSION_ENCRYPTED` –≤ Cloud Run

---

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è

- [–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è Cloud Run Environment Variables](https://cloud.google.com/run/docs/configuring/environment-variables)
- [Google Secret Manager](https://cloud.google.com/secret-manager/docs)
- [Telegram API Documentation](https://core.telegram.org/api)



